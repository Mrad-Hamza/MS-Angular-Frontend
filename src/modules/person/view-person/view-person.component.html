
<sb-layout-dashboard>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <sb-dashboard-head title="Dashboard" [hideBreadcrumbs]="false">

    </sb-dashboard-head>

        <table class="table table-striped">
    <thead>
        <tr>
            <th scope="col">Id</th>
            <th scope="col">Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Birth Date</th>
            <th scope="col">Role</th>
            <th scope="col">Source</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th scope="row">1</th>
            <td> {{person.name}} </td>
            <td> {{person.last_name}} </td>
            <td> {{person.birth_date}}</td>
            <td> {{person.role}}</td>
            <td> {{person.source}}</td>
            <td> <button type="button" name="update" (click)="update()" class="btn btn-dark">Update</button></td>
            <td><button type="submit" class="btn btn-danger" [routerLink]="['/person/all']"
                    (click)="delete(person)">Delete</button>
            </td>
        </tr>
    </tbody>
        </table>

<!-- <p-rating [(ngModel)]="val"></p-rating>
<p-rating></p-rating> -->


        <div *ngIf="updateEtat">
<!--     <app-update-rayon [rayon]="rayon"></app-update-rayon> aaaaa
        -->
            <sb-update-person [person]="person"></sb-update-person>
        </div>

        <div>
            <h3 class="m-0" (click)="salesmanButtonClicked()">Salesman</h3>
        </div><!-- /.container-fluid -->

        <div *ngIf="salesmanClicked">
            <div *ngIf="person.salesman!==null">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">First Name</th>
                            <th scope="col">Last Name</th>
                            <th scope="col">Phone number</th>
                            <th scope="col">Salary</th>
                            <th scope="col">Bonus</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">{{person.salesman.id}}</th>
                            <td> {{person.salesman.first_name}} </td>
                            <td> {{person.salesman.last_name}} </td>
                            <td> {{person.salesman.phone_numver}}</td>
                            <td> {{person.salesman.salary}}</td>
                            <td> {{person.salesman.bonus}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div *ngIf="person.salesman==null">
                <br/>
                <h4>This client/lead has no salesman. You can affect him to one.</h4>
                <select [(ngModel)]="salesmanId">
                    <option *ngFor="let s of salesmans" [ngValue]="s.id">{{s.first_name}} {{s.last_name}}</option>
                </select><br/>
                <button type="button" class="btn btn-sm btn-primary product-btn" (click)="addClientToSalesman()">View
                    Add
                </button>
            </div>
        </div>

        <br />
        <div>
            <h3 class="m-0" (click)="promotionsButtonClicked()">Promotions</h3>
        </div><!-- /.container-fluid -->

        <div *ngIf="promotionsClicked">
                <h4>This client/lead has no promotions. You can affect him to one.</h4>
                <select [(ngModel)]="promotionId">
                    <option *ngFor="let p of allPromotions" [ngValue]="p.id">{{p.id}} {{p.code}}</option>
                </select><br />
                <button type="button" class="btn btn-sm btn-primary product-btn" (click)="addPromotionToSalesman()">View
                    Add
                </button><br/>
            <div *ngIf="person.promotions?.length!==0">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">Code</th>
                            <th scope="col">Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let p of person.promotions">
                            <th scope="row">{{ p.id }}</th>
                            <td>
                                {{ p.code }}
                            </td>
                            <td>{{ p.percentage }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <br />
        <div>
            <h3 class="m-0" (click)="purchasesButtonClicked()">Purchases</h3>
        </div><!-- /.container-fluid -->
        <div *ngIf="purchasesClicked">
                <select [(ngModel)]="purchaseId">
                    <option *ngFor="let p of allPurchases" [ngValue]="p.id">{{p.id}} {{p.value}}</option>
                </select><br />
                <button type="button" class="btn btn-sm btn-primary product-btn" (click)="addPurchaseToSalesman()">View
                    Add
                </button>
            <br/>
            <div *ngIf="person.purchases?.length!==0">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">id</th>
                            <th scope="col">Purchase Date</th>
                            <th scope="col">Value</th>
                            <th scope="col">Promotion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let p of person.purchases">
                            <th scope="row">{{ p.id }}</th>
                            <td>
                                {{ p.purchase_date }}
                            </td>
                            <td>{{ p.value }}</td>
                            <td>
                                <div *ngIf="p.promotion">
                                    Oui
                                </div>
                                <div *ngIf="!p.promotion">
                                    Non
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

</sb-layout-dashboard>
